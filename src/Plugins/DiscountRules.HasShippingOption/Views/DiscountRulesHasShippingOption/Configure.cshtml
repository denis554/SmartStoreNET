@{
    Layout = "";
}
@model SmartStore.Plugin.DiscountRules.HasShippingOption.Models.RequirementModel
@using SmartStore.Web.Framework;
@using SmartStore;

<script type="text/javascript">
    $(document).ready(function () {
    	$('#savehasshippingoptionrequirement@(Model.RequirementId)').click(function () {
    		var shippingOptions = $("#@Html.FieldIdFor(model => model.ShippingOptions)").val();
            var discountId = @Model.DiscountId;
    		var requirementId = @Model.RequirementId;

            $.ajax({
                cache:false,
                type: "POST",
                url: "@(Url.Action("Configure", "DiscountRulesHasShippingOption"))",
            	data: { "discountId": discountId, "discountRequirementId": requirementId, "shippingOptions": shippingOptions ? shippingOptions.join() : '' },
                success: function (data) {
                        $('#pnl-save-requirement-result@(Model.RequirementId)').fadeIn("slow").delay(1000).fadeOut("slow");
                        //notify parent if it's a new requirement
                        @if (Model.RequirementId == 0)
                        {
                        <text>$("#discountRequirementContainer").trigger('smnewdiscountruleadded', [data.NewRequirementId]);</text>
                        }
                },
                error: function (xhr, ajaxOptions, thrownError){
                    alert('@T("Admin.Promotions.Discounts.Requirements.FailedToSave")')
                }  
            });
    	});

    	var selectedShippingMethods = '@Model.ShippingOptions.EmptyNull()'.split(',');
    	$("#@Html.FieldIdFor(model => model.ShippingOptions)").select2().select2('val', selectedShippingMethods);
    });
</script>
    
<table class="adminContent">
<tr>
    <td class="adminTitle">
        @Html.SmartLabelFor(model => model.ShippingOptions)
    </td>
    <td class="adminData">
        <div>
			@Html.DropDownListFor(model => model.ShippingOptions, Model.AvailableShippingMethods, null, new { multiple = "multiple" })
			<button type="button" name="savehasshippingoptionrequirement@(Model.RequirementId)" id="savehasshippingoptionrequirement@(Model.RequirementId)" class="btn" style="margin-top:3px;">
				@T("Admin.Common.Save")
			</button>
        </div>
        <div id="pnl-save-requirement-result@(Model.RequirementId)" style="display:none;">
			@T("Admin.Promotions.Discounts.Requirements.Saved")
        </div>
    </td>
</tr>
</table>