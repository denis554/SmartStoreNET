!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){function n(e,n){return"pairs"==n&&"string"==typeof e?e:"object"==typeof e&&null!=e[n]?e[n]:o[n]}function t(t){for(var a=0;a<t.length;a++){var o=t.charAt(a),c="'"+o+"'";l[c]||(l[c]=function(t){return function(a){return function(t,a){var o=r(t);if(!o||t.getOption("disableInput"))return e.Pass;var l=n(o,"pairs"),c=l.indexOf(a);if(-1==c)return e.Pass;for(var f,h=n(o,"triples"),u=l.charAt(c+1)==a,d=t.listSelections(),g=c%2==0,p=0;p<d.length;p++){var v,m=d[p],b=m.head,C=t.getRange(b,s(b.line,b.ch+1));if(g&&!m.empty())v="surround";else if(!u&&g||C!=a)if(u&&b.ch>1&&h.indexOf(a)>=0&&t.getRange(s(b.line,b.ch-2),b)==a+a&&(b.ch<=2||t.getRange(s(b.line,b.ch-3),s(b.line,b.ch-2))!=a))v="addFour";else if(u){var x=0==b.ch?" ":t.getRange(s(b.line,b.ch-1),b);if(e.isWordChar(C)||x==a||e.isWordChar(x))return e.Pass;v="both"}else{if(!g||t.getLine(b.line).length!=b.ch&&!function(e,n){var t=n.lastIndexOf(e);return t>-1&&t%2==1}(C,l)&&!/\s/.test(C))return e.Pass;v="both"}else v=u&&function(e,n){var t=e.getTokenAt(s(n.line,n.ch+1));return/\bstring/.test(t.type)&&t.start==n.ch&&(0==n.ch||!/\bstring/.test(e.getTokenTypeAt(n)))}(t,b)?"both":h.indexOf(a)>=0&&t.getRange(b,s(b.line,b.ch+3))==a+a+a?"skipThree":"skip";if(f){if(f!=v)return e.Pass}else f=v}var P=c%2?l.charAt(c-1):a,k=c%2?a:l.charAt(c+1);t.operation(function(){if("skip"==f)t.execCommand("goCharRight");else if("skipThree"==f)for(var e=0;e<3;e++)t.execCommand("goCharRight");else if("surround"==f){for(var n=t.getSelections(),e=0;e<n.length;e++)n[e]=P+n[e]+k;t.replaceSelections(n,"around"),n=t.listSelections().slice();for(var e=0;e<n.length;e++)n[e]=i(n[e]);t.setSelections(n)}else"both"==f?(t.replaceSelection(P+k,null),t.triggerElectric(P+k),t.execCommand("goCharLeft")):"addFour"==f&&(t.replaceSelection(P+P+P+P,"before"),t.execCommand("goCharRight"))})}(a,t)}}(o))}}function r(e){var n=e.state.closeBrackets;if(!n||n.override)return n;return e.getModeAt(e.getCursor()).closeBrackets||n}function i(n){var t=e.cmpPos(n.anchor,n.head)>0;return{anchor:new s(n.anchor.line,n.anchor.ch+(t?-1:1)),head:new s(n.head.line,n.head.ch+(t?1:-1))}}function a(e,n){var t=e.getRange(s(n.line,n.ch-1),s(n.line,n.ch+1));return 2==t.length?t:null}var o={pairs:"()[]{}''\"\"",triples:"",explode:"[]{}"},s=e.Pos;e.defineOption("autoCloseBrackets",!1,function(r,i,a){a&&a!=e.Init&&(r.removeKeyMap(l),r.state.closeBrackets=null),i&&(t(n(i,"pairs")),r.state.closeBrackets=i,r.addKeyMap(l))});var l={Backspace:function(t){var i=r(t);if(!i||t.getOption("disableInput"))return e.Pass;for(var o=n(i,"pairs"),l=t.listSelections(),c=0;c<l.length;c++){if(!l[c].empty())return e.Pass;var f=a(t,l[c].head);if(!f||o.indexOf(f)%2!=0)return e.Pass}for(c=l.length-1;c>=0;c--){var h=l[c].head;t.replaceRange("",s(h.line,h.ch-1),s(h.line,h.ch+1),"+delete")}},Enter:function(t){var i=r(t),o=i&&n(i,"explode");if(!o||t.getOption("disableInput"))return e.Pass;for(var s=t.listSelections(),l=0;l<s.length;l++){if(!s[l].empty())return e.Pass;var c=a(t,s[l].head);if(!c||o.indexOf(c)%2!=0)return e.Pass}t.operation(function(){var e=t.lineSeparator()||"\n";t.replaceSelection(e+e,null),t.execCommand("goCharLeft"),s=t.listSelections();for(var n=0;n<s.length;n++){var r=s[n].head.line;t.indentLine(r,null,!0),t.indentLine(r+1,null,!0)}})}};t(o.pairs+"`")});