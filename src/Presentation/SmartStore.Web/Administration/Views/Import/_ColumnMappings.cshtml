@using SmartStore.Admin.Models.DataExchange;
@model ImportProfileModel
@{
	var delete = T("Common.Delete");
	var ignore = @T("Admin.Common.Ignore");
	var selectTargetProperty = T("Admin.DataExchange.Import.SelectTargetProperty");
}

<div>
	<table class="adminContent">
		<tr class="adminSeparator">
			<td>
				<div class="admin-config-group">
					<div class="title">@T("Admin.DataExchange.Import.ColumnMapping")</div>
				</div>
			</td>
		</tr>
		<tr>
			<td>
				<div class="alert alert-info">
					<button type="button" class="close" data-dismiss="alert">&#215;</button>
					@Html.Raw(T("Admin.DataExchange.ColumnMapping.Note"))
				</div>
				@if (Model.ColumnMappings.Any())
				{
					<button id="ResetColumnMappings" type="button" class="btn btn-above" data-url="@Url.Action("ResetColumnMappings", new { id = Model.Id })">
						<i class="fa fa-refresh"></i>&nbsp;@T("Admin.Common.Clear")
					</button>
				}
			</td>
		</tr>
	</table>
</div>

<div id="MappingTemplateProperty" class="hide">
	<div class="mapping-edit">
		<select class="select-property noskin" data-placeholder="@selectTargetProperty" style="width: 550px;">
			<option></option>
			@foreach (var property in Model.AvailableEntityProperties)
			{
				<option value="@property.Value">@property.Text</option>
			}
		</select>
		<button type="button" class="btn btn-primary mapping-apply"><i class="fa fa-check"></i></button>
		<button type="button" class="btn mapping-cancel"><i class="fa fa-times"></i></button>
	</div>
</div>

<div id="MappingTemplateColumn" class="hide">
	<div class="mapping-edit">
		<select class="select-column noskin" data-placeholder="@ignore" style="width: 550px;">
			<option></option>
			@foreach (var column in Model.AvailableSourceColumns)
			{
				<option value="@column.Column">@column.ColumnLocalized</option>
			}
		</select>
		<button type="button" class="btn btn-primary mapping-apply"><i class="fa fa-check"></i></button>
		<button type="button" class="btn mapping-cancel"><i class="fa fa-times"></i></button>
	</div>
</div>

<div id="MappingAddTemplate" class="hide">
	<table>
		<tbody>
			<tr class="column-mapping-new">
				<td>
					<div class="mapping-item mapping-property">
						<input type="hidden" class="input-property" value="" />
						<div class="item-inner hide">
							<span class="property-icon">
								<i class="text-success fa fa-fw"></i>
							</span>
							<span class="left-label"></span>
							<span class="muted right-label"></span>
						</div>
						<select class="select-property noskin" data-placeholder="@selectTargetProperty">
							<option></option>
							@foreach (var property in Model.AvailableEntityProperties)
							{
								<option value="@property.Value">@property.Text</option>
							}
						</select>
					</div>
				</td>
				<td>
					<div class="mapping-item mapping-column">
						<input type="hidden" class="input-column" value="" />
						<div class="item-inner hide">
							<span class="left-label"></span>
						</div>
						<select class="select-column noskin" data-placeholder="@ignore">
							<option></option>
							@foreach (var column in Model.AvailableSourceColumns)
							{
								<option value="@column.Column">@column.ColumnLocalized</option>
							}
						</select>
					</div>
				</td>
				<td>
					<input type="text" class="input-default text-box single-line" value="" />
				</td>
				<td>
					<button type="button" class="btn btn-block btn-warning mapping-add" disabled="disabled">
						<i class="fa fa-plus"></i>&nbsp;@T("Common.AddNew")
					</button>
					<button type="button" class="btn btn-block btn-danger hide mapping-delete">
						<i class="fa fa-trash"></i>&nbsp;@delete
					</button>
				</td>
			</tr>
		</tbody>
	</table>
</div>

<div id="ImportColumnMappings">
	<table class="table table-striped admin-table column-mapping" data-maxindex="@Model.ColumnMappings.Count">
		<thead>
			<tr>
				<th class="column-one">@T("Admin.DataExchange.ColumnMapping.EntityProperty")</th>
				<th class="column-two">@T("Admin.DataExchange.ColumnMapping.ImportField")</th>			
				<th>@T("Admin.DataExchange.ColumnMapping.DefaultValue")</th>
				<th>&nbsp;</th>
			</tr>
		</thead>
		<tbody>
			@foreach (var mapping in Model.ColumnMappings)
			{
				var index = Model.ColumnMappings.IndexOf(mapping) + 1;
				<tr>
					<td>
						<div class="mapping-item mapping-property">
							<input type="hidden" name="ColumnMapping.Property.@(index)" value="@mapping.Property" />
							<div class="item-inner">
								<span class="property-icon">
									<i class="text-success fa fa-fw @(mapping.Column.EmptyNull().EndsWith("]") ? "fa-globe" : "fa-chain-broken")"></i>
								</span>
								@if (mapping.Text.Length > 50)
								{
									<span class="left-label" title="@mapping.Text">@(mapping.Text.Substring(0, 50))…</span>
								}
								else
								{
									<span class="left-label">@mapping.Text</span>
								}
								<span class="muted right-label">@mapping.Column</span>
							</div>
						</div>
					</td>
					<td>
						<div class="mapping-item mapping-column">
							<input type="hidden" name="ColumnMapping.Column.@(index)" value="@mapping.Column" />
							<div class="item-inner">
								@*TODO: display ignored properties in a multi-select on top of mapping table. user must be able to revise the ignoring.*@
								@if (mapping.Column.HasValue())
								{
									<span class="left-label">@mapping.Column</span>
								}
								else
								{
									<span class="left-label muted">@ignore</span>
								}
							</div>
						</div>
					</td>
					<td>
						<input type="text" name="ColumnMapping.Default.@(index)" class="input-default text-box single-line" value="@mapping.Default" />
					</td>
					<td>
						<button type="button" class="btn btn-block btn-danger mapping-delete">
							<i class="fa fa-trash"></i>&nbsp;@delete
						</button>
					</td>
				</tr>
			}
		</tbody>
	</table>
</div>